<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8" />
<link rel="help"
      href="http://www.w3.org/TR/resource-timing/#performanceresourcetiming"/>
<title>This test validates that resource timing implementations have a finite
       number of entries in their buffer.</title>
<meta name="timeout" content="long">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
</head>
<body>
<script>
promise_test(t => {
  return new Promise(resolve => {
    let counter = 0;
    performance.onresourcetimingbufferfull = resolve;
    const loadImagesRecursively = () => {
      // Load an image.
      (new Image()).src = "resources/blue.png?" + counter;
      ++counter;
      // Yield to enable queueing an entry, then recursively load another image.
      t.step_timeout(loadImagesRecursively, 0);
    };
    loadImagesRecursively();
  });
}, "Finite resource timing entries buffer size");
</script>
</body>
</html>
