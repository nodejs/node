language: node_js

jobs:
  fast_finish: true
  allow_failures:
    - stage: security scan ğŸ”

  include:
    - stage: unit tests ğŸ‘©ğŸ½â€ğŸ’»
      script: npm run test:unit
      node_js: lts/*

    - stage: spec tests ğŸ‘©ğŸ½â€ğŸ’»
      script: npm run test:specs
      node_js: v0.10
    - node_js: v4
    - node_js: lts/*
    - node_js: node

    - stage: lint âœ¨
      script: npm run test:lint
      node_js: lts/*

    - stage: minify ğŸ—œï¸
      script: |
        npm run build
        if ! git diff --quiet; then
          git config --global user.email "travis@travis-ci.org"
          git config --global user.name "Travis-CI"
          git config credential.helper "store --file=.git/credentials"
          echo "https://${GITHUB_TOKEN}:@github.com" > .git/credentials
          git commit -am 'ğŸ—œï¸ minify [skip ci]'
          git push origin HEAD:${TRAVIS_BRANCH}
        fi
      node_js: lts/*
      if: branch = master AND type = push

    - stage: security scan ğŸ”
      script: npm run test:redos
      node_js: lts/*

cache:
  directories:
    - node_modules
